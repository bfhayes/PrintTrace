@startuml OutlineTool-DataFlow
!theme plain
title OutlineTool - Data Flow Architecture

skinparam rectangle {
    BackgroundColor LightYellow
    BorderColor Black
}

skinparam storage {
    BackgroundColor LightBlue
    BorderColor Blue
}

skinparam process {
    BackgroundColor LightGreen
    BorderColor Green
}

rectangle "Input" as INPUT {
    storage "Image File\n(JPG/PNG/etc)" as ImageFile
    storage "Command Args\n(-i input -o output)" as CmdArgs
}

rectangle "Preprocessing" as PREPROCESS {
    process "Load & Validate\nImage" as LoadImg
    process "Convert to\nGrayscale" as ToGray
    process "Binary\nThreshold" as Threshold
}

rectangle "Boundary Detection" as BOUNDARY {
    process "Find All\nContours" as FindContours
    process "Select Largest\nContour" as SelectLarge
    process "Approximate\nPolygon" as ApproxPoly
}

rectangle "Perspective Correction" as PERSPECTIVE {
    process "Identify 4\nCorners" as FindCorners
    process "Calculate Transform\nMatrix" as CalcTransform
    process "Warp to Square\nFormat" as WarpImage
}

rectangle "Noise Reduction" as DENOISE {
    process "Morphological\nOperations" as Morphology
    process "Gaussian\nBlur" as Blur
    process "Final\nThreshold" as FinalThresh
}

rectangle "Object Extraction" as EXTRACT {
    process "Find Object\nContours" as FindObject
    process "Select Main\nObject" as SelectMain
}

rectangle "Export Processing" as EXPORT {
    process "Convert Pixels\nto Millimeters" as PixelToMM
    process "Create DXF\nPolyline" as CreatePoly
    process "Write DXF\nFile" as WriteDXF
}

rectangle "Output" as OUTPUT {
    storage "DXF File\n(Vector Format)" as DXFFile
    storage "Console Output\n(Success/Error)" as ConsoleOut
}

' Data flow arrows
ImageFile --> LoadImg : RGB Image Data
CmdArgs --> LoadImg : File Path
LoadImg --> ToGray : Validated Mat
ToGray --> Threshold : Grayscale Mat
Threshold --> FindContours : Binary Mat

FindContours --> SelectLarge : Vector<Contours>
SelectLarge --> ApproxPoly : Largest Contour
ApproxPoly --> FindCorners : Polygon Points

FindCorners --> CalcTransform : 4 Corner Points
CalcTransform --> WarpImage : Transform Matrix
WarpImage --> Morphology : Warped Mat + PPM

Morphology --> Blur : Opened/Closed Mat
Blur --> FinalThresh : Blurred Mat
FinalThresh --> FindObject : Clean Binary Mat

FindObject --> SelectMain : Object Contours
SelectMain --> PixelToMM : Main Object Contour

PixelToMM --> CreatePoly : Scaled Coordinates
CreatePoly --> WriteDXF : DXF Polyline
WriteDXF --> DXFFile : Binary DXF Data
WriteDXF --> ConsoleOut : Status Messages

' Data annotations
note right of LoadImg
  Validates file existence,
  image format, minimum size
end note

note right of ApproxPoly
  Reduces contour complexity
  using Douglas-Peucker algorithm
end note

note right of WarpImage
  Calculates pixels-per-millimeter
  ratio for real-world scaling
end note

note right of PixelToMM
  Converts from image coordinates
  to CAD coordinates (mm units)
end note

' Processing stages
note top of PREPROCESS : Stage 1: Image Preparation
note top of BOUNDARY : Stage 2: Boundary Detection
note top of PERSPECTIVE : Stage 3: Geometric Correction
note top of DENOISE : Stage 4: Image Enhancement
note top of EXTRACT : Stage 5: Object Identification
note top of EXPORT : Stage 6: Format Conversion

@enduml